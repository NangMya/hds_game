{
    "sourceFile": "components/FreeMap_bk.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1768968422055,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1768968422055,
            "name": "Commit-0",
            "content": "\"use client\";\r\nimport { useState, useEffect, useMemo } from \"react\";\r\nimport { MapContainer, Marker, ImageOverlay, useMap } from \"react-leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport L from \"leaflet\";\r\n\r\nconst LAT_PER_FOOT = 1 / 364000;\r\nconst LON_PER_FOOT = 1 / (364000 * Math.cos(16.8076918 * Math.PI / 180));\r\nconst AREA_SIZE = 60; \r\n\r\n// Camera Follow Component\r\nfunction MapCamera({ gpsPosition }: { gpsPosition: [number, number] }) {\r\n  const map = useMap();\r\n\r\n  useEffect(() => {\r\n    // လက်နဲ့ လုံးဝ ရွှေ့လို့ မရအောင် လုပ်ဆောင်ချက်အားလုံးကို ပိတ်ထားခြင်း\r\n    map.dragging.disable();\r\n    map.touchZoom.disable();\r\n    map.doubleClickZoom.disable();\r\n    map.scrollWheelZoom.disable();\r\n    map.boxZoom.disable();\r\n    map.keyboard.disable();\r\n    if ((map as any).tap) (map as any).tap.disable();\r\n    \r\n    // GPS အတိုင်းသာ Camera ကို ရွှေ့ပေးခြင်း\r\n    map.setView(gpsPosition, map.getZoom(), { animate: true, duration: 0.8 });\r\n  }, [gpsPosition, map]);\r\n\r\n  return null;\r\n}\r\n\r\nexport default function FreeMap({ boxes: initialBoxes, centerLat, centerLng }: any) {\r\n  const [gpsPosition, setGpsPosition] = useState<[number, number]>([centerLat, centerLng]);\r\n  const [gameBoxes, setGameBoxes] = useState(initialBoxes);\r\n  \r\n  const imageBounds = useMemo(() => {\r\n    const latOffset = (AREA_SIZE / 2) * LAT_PER_FOOT;\r\n    const lngOffset = (AREA_SIZE / 2) * LON_PER_FOOT;\r\n    return [\r\n      [centerLat - latOffset, centerLng - lngOffset],\r\n      [centerLat + latOffset, centerLng + lngOffset],\r\n    ] as L.LatLngBoundsExpression;\r\n  }, [centerLat, centerLng]);\r\n\r\n  const charIcon = useMemo(() => L.icon({\r\n    iconUrl: \"/images/human.png\",\r\n    iconSize: [100, 100],\r\n    iconAnchor: [50, 50], \r\n  }), []);\r\n\r\n  const boxIcon = useMemo(() => L.icon({\r\n    iconUrl: \"/images/box.png\",\r\n    iconSize: [45, 45],\r\n    iconAnchor: [22, 22],\r\n  }), []);\r\n\r\n  useEffect(() => {\r\n    const watchId = navigator.geolocation.watchPosition(\r\n      (pos) => {\r\n        const { latitude, longitude, accuracy } = pos.coords;\r\n        if (accuracy > 30) return; \r\n        setGpsPosition([latitude, longitude]);\r\n      },\r\n      console.error,\r\n      { enableHighAccuracy: true, maximumAge: 0 }\r\n    );\r\n    return () => navigator.geolocation.clearWatch(watchId);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"h-screen w-full relative bg-[#0a0a0a] overflow-hidden touch-none\">\r\n      \r\n      {/* UI layer */}\r\n      <div className=\"absolute top-8 left-5 z-[1000] pointer-events-none\">\r\n        <div className=\"bg-black/70 p-3 rounded-2xl text-white font-bold border border-white/10 shadow-2xl\">\r\n          ⭐ Score: {gameBoxes.length} Remaining\r\n        </div>\r\n      </div>\r\n\r\n      <MapContainer\r\n        center={[centerLat, centerLng]}\r\n        zoom={22}\r\n        dragging={false} \r\n        zoomControl={false}\r\n        scrollWheelZoom={false}\r\n        doubleClickZoom={false}\r\n        touchZoom={false}\r\n        attributionControl={false}\r\n        style={{ height: \"100%\", width: \"100%\", background: \"transparent\" }}\r\n      >\r\n        <ImageOverlay url=\"/images/3.png\" bounds={imageBounds} />\r\n\r\n        {/* GPS နှင့် Camera ကို ချိတ်ဆက်ပေးခြင်း */}\r\n        <MapCamera gpsPosition={gpsPosition} />\r\n\r\n        {/* Character ကို အမြဲတမ်း Camera အလယ်မှာ ပေါ်နေစေဖို့ GPS Position ပေးထားခြင်း */}\r\n        <Marker position={gpsPosition} icon={charIcon} zIndexOffset={1000} />\r\n\r\n        {/* Boxes တွေကတော့ Map ပေါ်မှာ Fixed နေရာနဲ့ ကျန်ခဲ့မယ် */}\r\n        {gameBoxes.map((box: any) => (\r\n          <Marker\r\n            key={box.id}\r\n            position={[box.lat, box.lng]}\r\n            icon={boxIcon}\r\n          />\r\n        ))}\r\n      </MapContainer>\r\n\r\n      {/* လမ်းညွှန်ချက် အပို (Overlay) */}\r\n      <div className=\"absolute bottom-10 left-1/2 -translate-x-1/2 z-[1000] text-white/50 text-sm italic font-light pointer-events-none\">\r\n        Move in real life to explore the map\r\n      </div>\r\n    </div>\r\n  );\r\n}"
        }
    ]
}