{
    "sourceFile": "components/FreeMap.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 36,
            "patches": [
                {
                    "date": 1768814044084,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1768814140837,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,9 +36,13 @@\n \r\n   return (\r\n     <div className=\"h-full w-full\">\r\n       <MapContainer center={position} zoom={19} style={{ height: \"100%\", width: \"100%\" }}>\r\n-        <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\r\n+        {/* <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" /> */}\r\n+        <TileLayer\r\n+  url=\"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png\"\r\n+  attribution='&copy; <a href=\"https://carto.com/attributions\">CARTO</a>'\r\n+/>\r\n         <ChangeView center={position} />\r\n         <Marker position={position} icon={icon} />\r\n         {boxes.map((box) => (\r\n           <Marker key={box.id} position={[box.lat, box.lng]} icon={icon} />\r\n"
                },
                {
                    "date": 1768814164411,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,11 +37,15 @@\n   return (\r\n     <div className=\"h-full w-full\">\r\n       <MapContainer center={position} zoom={19} style={{ height: \"100%\", width: \"100%\" }}>\r\n         {/* <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" /> */}\r\n-        <TileLayer\r\n+        {/* <TileLayer\r\n   url=\"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png\"\r\n   attribution='&copy; <a href=\"https://carto.com/attributions\">CARTO</a>'\r\n+/> */}\r\n+<TileLayer\r\n+  url=\"https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png\"\r\n+  attribution='&copy; <a href=\"https://stadiamaps.com/\">Stadia Maps</a>'\r\n />\r\n         <ChangeView center={position} />\r\n         <Marker position={position} icon={icon} />\r\n         {boxes.map((box) => (\r\n"
                },
                {
                    "date": 1768814445077,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,10 +21,17 @@\n \r\n // ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä±·Ä´·ÄÄ·Ä∫ default export ·Äñ·Äº·ÄÖ·Ä∫·Äõ·Äï·Ä´·Äô·Äö·Ä∫\r\n export default function FreeMap({ boxes }: { boxes: any[] }) {\r\n   const [position, setPosition] = useState<[number, number]>([16.8400, 96.1730]);\r\n-\r\n+function ChangeView({ center }: { center: [number, number] }) {\r\n+  const map = useMap();\r\n   useEffect(() => {\r\n+    // animate: true ·Äë·Ää·Ä∑·Ä∫·Äë·Ä¨·Ä∏·Äõ·ÄÑ·Ä∫ map ·Äõ·ÄΩ·Ä±·Ä∑·Äê·Ä¨ ·ÄÅ·Äª·Ä±·Ä¨·Äô·ÄΩ·Ä±·Ä∑·Äû·ÄΩ·Ä¨·Ä∏·Äô·Äö·Ä∫\r\n+    map.setView(center, map.getZoom(), { animate: true });\r\n+  }, [center, map]);\r\n+  return null;\r\n+}\r\n+  useEffect(() => {\r\n     if (typeof window !== \"undefined\") {\r\n       const watchId = navigator.geolocation.watchPosition(\r\n         (pos) => setPosition([pos.coords.latitude, pos.coords.longitude]),\r\n         (err) => console.error(err),\r\n"
                },
                {
                    "date": 1768814470988,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,63 +1,73 @@\n-// src/components/FreeMap.tsx\r\n \"use client\";\r\n-import { MapContainer, TileLayer, Marker, useMap } from \"react-leaflet\";\r\n+import { MapContainer, ImageOverlay, Marker, useMap } from \"react-leaflet\";\r\n import \"leaflet/dist/leaflet.css\";\r\n import L from \"leaflet\";\r\n import { useEffect, useState } from \"react\";\r\n \r\n-// Marker Icon Fix\r\n-const icon = L.icon({\r\n-  iconUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png\",\r\n-  shadowUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png\",\r\n+// Marker ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ Custom Icon (·Ä•·Äï·Äô·Ä¨- Pokemon ·Äú·Ä∞·Äõ·ÄØ·Äï·Ä∫·Äú·Ä±·Ä∏)\r\n+const charIcon = L.icon({\r\n+  iconUrl: \"/images/player-icon.png\", // ·ÄÄ·Ä≠·ÄØ·Äö·Ä∫·Äï·Ä≠·ÄØ·ÄÑ·Ä∫ icon ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´\r\n+  iconSize: [40, 40],\r\n });\r\n \r\n+const boxIcon = L.icon({\r\n+  iconUrl: \"https://cdn-icons-png.flaticon.com/512/3081/3081840.png\",\r\n+  iconSize: [35, 35],\r\n+});\r\n+\r\n+// Map Boundaries (·Äû·ÄÑ·Ä∑·Ä∫·Ä°·ÄÅ·Äî·Ä∫·Ä∏·Äõ·Ä≤·Ä∑ coordinates ·Äñ·Äº·ÄÖ·Ä∫·Äõ·Äô·Äö·Ä∫)\r\n+const bounds: L.LatLngBoundsExpression = [\r\n+  [16.8405, 96.1730], // Top-Left\r\n+  [16.8400, 96.1735], // Bottom-Right\r\n+];\r\n+\r\n function ChangeView({ center }: { center: [number, number] }) {\r\n   const map = useMap();\r\n   useEffect(() => {\r\n-    map.setView(center, map.getZoom());\r\n+    map.setView(center, map.getZoom(), { animate: true });\r\n   }, [center, map]);\r\n   return null;\r\n }\r\n \r\n-// ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä±·Ä´·ÄÄ·Ä∫ default export ·Äñ·Äº·ÄÖ·Ä∫·Äõ·Äï·Ä´·Äô·Äö·Ä∫\r\n export default function FreeMap({ boxes }: { boxes: any[] }) {\r\n-  const [position, setPosition] = useState<[number, number]>([16.8400, 96.1730]);\r\n-function ChangeView({ center }: { center: [number, number] }) {\r\n-  const map = useMap();\r\n+  const [position, setPosition] = useState<[number, number]>([16.8402, 96.1732]);\r\n+\r\n   useEffect(() => {\r\n-    // animate: true ·Äë·Ää·Ä∑·Ä∫·Äë·Ä¨·Ä∏·Äõ·ÄÑ·Ä∫ map ·Äõ·ÄΩ·Ä±·Ä∑·Äê·Ä¨ ·ÄÅ·Äª·Ä±·Ä¨·Äô·ÄΩ·Ä±·Ä∑·Äû·ÄΩ·Ä¨·Ä∏·Äô·Äö·Ä∫\r\n-    map.setView(center, map.getZoom(), { animate: true });\r\n-  }, [center, map]);\r\n-  return null;\r\n-}\r\n-  useEffect(() => {\r\n-    if (typeof window !== \"undefined\") {\r\n-      const watchId = navigator.geolocation.watchPosition(\r\n-        (pos) => setPosition([pos.coords.latitude, pos.coords.longitude]),\r\n-        (err) => console.error(err),\r\n-        { enableHighAccuracy: true }\r\n-      );\r\n-      return () => navigator.geolocation.clearWatch(watchId);\r\n-    }\r\n+    const watchId = navigator.geolocation.watchPosition(\r\n+      (pos) => setPosition([pos.coords.latitude, pos.coords.longitude]),\r\n+      (err) => console.error(err),\r\n+      { enableHighAccuracy: true }\r\n+    );\r\n+    return () => navigator.geolocation.clearWatch(watchId);\r\n   }, []);\r\n \r\n   return (\r\n-    <div className=\"h-full w-full\">\r\n-      <MapContainer center={position} zoom={19} style={{ height: \"100%\", width: \"100%\" }}>\r\n-        {/* <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" /> */}\r\n-        {/* <TileLayer\r\n-  url=\"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png\"\r\n-  attribution='&copy; <a href=\"https://carto.com/attributions\">CARTO</a>'\r\n-/> */}\r\n-<TileLayer\r\n-  url=\"https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png\"\r\n-  attribution='&copy; <a href=\"https://stadiamaps.com/\">Stadia Maps</a>'\r\n-/>\r\n+    <div className=\"h-screen w-full bg-slate-900\">\r\n+      <MapContainer \r\n+        center={position} \r\n+        zoom={20} \r\n+        maxBounds={bounds} // ·Ä°·ÄÅ·Äî·Ä∫·Ä∏·Ä°·Äï·Äº·ÄÑ·Ä∫·Äë·ÄΩ·ÄÄ·Ä∫·Äô·Äõ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫ ·Äï·Ä≠·Äê·Ä∫·Äë·Ä¨·Ä∏·Äô·Äö·Ä∫\r\n+        style={{ height: \"100%\", width: \"100%\" }}\r\n+        crs={L.CRS.EPSG3857} // Standard GPS system\r\n+      >\r\n+        {/* Real Map ·Ä°·ÄÖ·Ä¨·Ä∏ ·ÄÄ·Ä≠·ÄØ·Äö·Ä∫·Äï·Ä≠·ÄØ·ÄÑ·Ä∫ Image ·ÄÄ·Ä≠·ÄØ ·Äû·ÄØ·Ä∂·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ */}\r\n+        <ImageOverlay\r\n+          url=\"/images/virtual-map.png\"\r\n+          bounds={bounds}\r\n+          zIndex={10}\r\n+        />\r\n+\r\n         <ChangeView center={position} />\r\n-        <Marker position={position} icon={icon} />\r\n+\r\n+        {/* User Character */}\r\n+        <Marker position={position} icon={charIcon} />\r\n+\r\n+        {/* Treasure Boxes */}\r\n         {boxes.map((box) => (\r\n-          <Marker key={box.id} position={[box.lat, box.lng]} icon={icon} />\r\n+          <Marker key={box.id} position={[box.lat, box.lng]} icon={boxIcon}>\r\n+             {/* Click logic will be here */}\r\n+          </Marker>\r\n         ))}\r\n       </MapContainer>\r\n     </div>\r\n   );\r\n"
                },
                {
                    "date": 1768814546009,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,9 @@\n import { useEffect, useState } from \"react\";\r\n \r\n // Marker ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ Custom Icon (·Ä•·Äï·Äô·Ä¨- Pokemon ·Äú·Ä∞·Äõ·ÄØ·Äï·Ä∫·Äú·Ä±·Ä∏)\r\n const charIcon = L.icon({\r\n-  iconUrl: \"/images/player-icon.png\", // ·ÄÄ·Ä≠·ÄØ·Äö·Ä∫·Äï·Ä≠·ÄØ·ÄÑ·Ä∫ icon ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´\r\n+  iconUrl: \"/images/player.jpg\", // ·ÄÄ·Ä≠·ÄØ·Äö·Ä∫·Äï·Ä≠·ÄØ·ÄÑ·Ä∫ icon ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´\r\n   iconSize: [40, 40],\r\n });\r\n \r\n const boxIcon = L.icon({\r\n"
                },
                {
                    "date": 1768814559838,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,9 +51,9 @@\n         crs={L.CRS.EPSG3857} // Standard GPS system\r\n       >\r\n         {/* Real Map ·Ä°·ÄÖ·Ä¨·Ä∏ ·ÄÄ·Ä≠·ÄØ·Äö·Ä∫·Äï·Ä≠·ÄØ·ÄÑ·Ä∫ Image ·ÄÄ·Ä≠·ÄØ ·Äû·ÄØ·Ä∂·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ */}\r\n         <ImageOverlay\r\n-          url=\"/images/virtual-map.png\"\r\n+          url=\"/images/prev_27.png\"\r\n           bounds={bounds}\r\n           zIndex={10}\r\n         />\r\n \r\n"
                },
                {
                    "date": 1768814759412,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,16 +4,20 @@\n import L from \"leaflet\";\r\n import { useEffect, useState } from \"react\";\r\n \r\n // Marker ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ Custom Icon (·Ä•·Äï·Äô·Ä¨- Pokemon ·Äú·Ä∞·Äõ·ÄØ·Äï·Ä∫·Äú·Ä±·Ä∏)\r\n-const charIcon = L.icon({\r\n-  iconUrl: \"/images/player.jpg\", // ·ÄÄ·Ä≠·ÄØ·Äö·Ä∫·Äï·Ä≠·ÄØ·ÄÑ·Ä∫ icon ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´\r\n-  iconSize: [40, 40],\r\n+// Marker Icons ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏\r\n+const userIcon = L.icon({\r\n+  iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png\",\r\n+  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png\",\r\n+  iconSize: [25, 41],\r\n+  iconAnchor: [12, 41],\r\n });\r\n \r\n const boxIcon = L.icon({\r\n-  iconUrl: \"https://cdn-icons-png.flaticon.com/512/3081/3081840.png\",\r\n-  iconSize: [35, 35],\r\n+  iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png\",\r\n+  iconSize: [25, 41],\r\n+  iconAnchor: [12, 41],\r\n });\r\n \r\n // Map Boundaries (·Äû·ÄÑ·Ä∑·Ä∫·Ä°·ÄÅ·Äî·Ä∫·Ä∏·Äõ·Ä≤·Ä∑ coordinates ·Äñ·Äº·ÄÖ·Ä∫·Äõ·Äô·Äö·Ä∫)\r\n const bounds: L.LatLngBoundsExpression = [\r\n"
                },
                {
                    "date": 1768814777061,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,9 @@\n import { useEffect, useState } from \"react\";\r\n \r\n // Marker ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ Custom Icon (·Ä•·Äï·Äô·Ä¨- Pokemon ·Äú·Ä∞·Äõ·ÄØ·Äï·Ä∫·Äú·Ä±·Ä∏)\r\n // Marker Icons ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏\r\n-const userIcon = L.icon({\r\n+const charIcon = L.icon({\r\n   iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png\",\r\n   shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png\",\r\n   iconSize: [25, 41],\r\n   iconAnchor: [12, 41],\r\n"
                },
                {
                    "date": 1768814904504,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,11 +5,10 @@\n import { useEffect, useState } from \"react\";\r\n \r\n // Marker ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ Custom Icon (·Ä•·Äï·Äô·Ä¨- Pokemon ·Äú·Ä∞·Äõ·ÄØ·Äï·Ä∫·Äú·Ä±·Ä∏)\r\n // Marker Icons ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏\r\n-const charIcon = L.icon({\r\n-  iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png\",\r\n-  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png\",\r\n+const charIcon  = L.icon({\r\n+  iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png\",\r\n   iconSize: [25, 41],\r\n   iconAnchor: [12, 41],\r\n });\r\n \r\n"
                },
                {
                    "date": 1768814965922,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,17 @@\n }\r\n \r\n export default function FreeMap({ boxes }: { boxes: any[] }) {\r\n   const [position, setPosition] = useState<[number, number]>([16.8402, 96.1732]);\r\n+const [gameBoxes, setGameBoxes] = useState(initialBoxes);\r\n+  const [score, setScore] = useState(0);\r\n \r\n+  const handleCollect = (id: number) => {\r\n+    // Collect ·Äú·ÄØ·Äï·Ä∫·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äê·Ä≤·Ä∑ box ·ÄÄ·Ä≠·ÄØ map ·Äï·Ä±·Ä´·Ä∫·ÄÄ ·Äñ·Äö·Ä∫·Äë·ÄØ·Äê·Ä∫·Äô·Äö·Ä∫\r\n+    setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n+    setScore(prev => prev + 10);\r\n+    alert(\"·Äû·Ä±·Äê·Äπ·Äê·Ä¨·Äõ·Äï·Äº·ÄÆ! Point +10\");\r\n+  };\r\n   useEffect(() => {\r\n     const watchId = navigator.geolocation.watchPosition(\r\n       (pos) => setPosition([pos.coords.latitude, pos.coords.longitude]),\r\n       (err) => console.error(err),\r\n"
                },
                {
                    "date": 1768814979761,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n   }, [center, map]);\r\n   return null;\r\n }\r\n \r\n-export default function FreeMap({ boxes }: { boxes: any[] }) {\r\n+export default function FreeMap({ boxes: initialBoxes }: { boxes: any[] }) {\r\n   const [position, setPosition] = useState<[number, number]>([16.8402, 96.1732]);\r\n const [gameBoxes, setGameBoxes] = useState(initialBoxes);\r\n   const [score, setScore] = useState(0);\r\n \r\n"
                },
                {
                    "date": 1768814997112,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -72,12 +72,10 @@\n \r\n         {/* User Character */}\r\n         <Marker position={position} icon={charIcon} />\r\n \r\n-        {/* Treasure Boxes */}\r\n-        {boxes.map((box) => (\r\n+        {boxes?.map((box) => (\r\n           <Marker key={box.id} position={[box.lat, box.lng]} icon={boxIcon}>\r\n-             {/* Click logic will be here */}\r\n           </Marker>\r\n         ))}\r\n       </MapContainer>\r\n     </div>\r\n"
                },
                {
                    "date": 1768815029675,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,28 +1,14 @@\n \"use client\";\r\n-import { MapContainer, ImageOverlay, Marker, useMap } from \"react-leaflet\";\r\n+import { MapContainer, ImageOverlay, Marker, useMap, useMapEvents } from \"react-leaflet\";\r\n import \"leaflet/dist/leaflet.css\";\r\n import L from \"leaflet\";\r\n import { useEffect, useState } from \"react\";\r\n \r\n-// Marker ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ Custom Icon (·Ä•·Äï·Äô·Ä¨- Pokemon ·Äú·Ä∞·Äõ·ÄØ·Äï·Ä∫·Äú·Ä±·Ä∏)\r\n-// Marker Icons ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏\r\n-const charIcon  = L.icon({\r\n-  iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png\",\r\n-  iconSize: [25, 41],\r\n-  iconAnchor: [12, 41],\r\n-});\r\n-\r\n-const boxIcon = L.icon({\r\n-  iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png\",\r\n-  iconSize: [25, 41],\r\n-  iconAnchor: [12, 41],\r\n-});\r\n-\r\n-// Map Boundaries (·Äû·ÄÑ·Ä∑·Ä∫·Ä°·ÄÅ·Äî·Ä∫·Ä∏·Äõ·Ä≤·Ä∑ coordinates ·Äñ·Äº·ÄÖ·Ä∫·Äõ·Äô·Äö·Ä∫)\r\n+// Boundary ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ ·Ä°·Äï·Äº·ÄÑ·Ä∫·Äô·Äæ·Ä¨ ·Äë·Ä¨·Ä∏·Äú·Ä≠·ÄØ·Ä∑·Äõ·Äï·Ä´·Äê·Äö·Ä∫\r\n const bounds: L.LatLngBoundsExpression = [\r\n-  [16.8405, 96.1730], // Top-Left\r\n-  [16.8400, 96.1735], // Bottom-Right\r\n+  [16.8405, 96.1730],\r\n+  [16.8400, 96.1735],\r\n ];\r\n \r\n function ChangeView({ center }: { center: [number, number] }) {\r\n   const map = useMap();\r\n@@ -33,50 +19,75 @@\n }\r\n \r\n export default function FreeMap({ boxes: initialBoxes }: { boxes: any[] }) {\r\n   const [position, setPosition] = useState<[number, number]>([16.8402, 96.1732]);\r\n-const [gameBoxes, setGameBoxes] = useState(initialBoxes);\r\n+  const [gameBoxes, setGameBoxes] = useState(initialBoxes);\r\n   const [score, setScore] = useState(0);\r\n \r\n+  // ·ÅÅ·Åã Icon ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ Component ·Äë·Ä≤·Äû·Ä≠·ÄØ·Ä∑ ·Äõ·ÄΩ·Äæ·Ä±·Ä∑·Äï·Ä´\r\n+  const charIcon = L.icon({\r\n+    iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png\",\r\n+    iconSize: [25, 41],\r\n+    iconAnchor: [12, 41],\r\n+  });\r\n+\r\n+  const boxIcon = L.icon({\r\n+    iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png\",\r\n+    iconSize: [25, 41],\r\n+    iconAnchor: [12, 41],\r\n+  });\r\n+\r\n   const handleCollect = (id: number) => {\r\n-    // Collect ·Äú·ÄØ·Äï·Ä∫·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äê·Ä≤·Ä∑ box ·ÄÄ·Ä≠·ÄØ map ·Äï·Ä±·Ä´·Ä∫·ÄÄ ·Äñ·Äö·Ä∫·Äë·ÄØ·Äê·Ä∫·Äô·Äö·Ä∫\r\n     setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n     setScore(prev => prev + 10);\r\n     alert(\"·Äû·Ä±·Äê·Äπ·Äê·Ä¨·Äõ·Äï·Äº·ÄÆ! Point +10\");\r\n   };\r\n+\r\n   useEffect(() => {\r\n-    const watchId = navigator.geolocation.watchPosition(\r\n-      (pos) => setPosition([pos.coords.latitude, pos.coords.longitude]),\r\n-      (err) => console.error(err),\r\n-      { enableHighAccuracy: true }\r\n-    );\r\n-    return () => navigator.geolocation.clearWatch(watchId);\r\n+    if (typeof window !== \"undefined\") {\r\n+      const watchId = navigator.geolocation.watchPosition(\r\n+        (pos) => setPosition([pos.coords.latitude, pos.coords.longitude]),\r\n+        (err) => console.error(err),\r\n+        { enableHighAccuracy: true }\r\n+      );\r\n+      return () => navigator.geolocation.clearWatch(watchId);\r\n+    }\r\n   }, []);\r\n \r\n   return (\r\n-    <div className=\"h-screen w-full bg-slate-900\">\r\n+    <div className=\"h-screen w-full bg-slate-900 relative\">\r\n+      {/* Score UI */}\r\n+      <div className=\"absolute top-5 left-5 z-[1000] bg-white p-3 rounded-xl shadow-lg text-black font-bold\">\r\n+        Score: {score}\r\n+      </div>\r\n+\r\n       <MapContainer \r\n         center={position} \r\n         zoom={20} \r\n-        maxBounds={bounds} // ·Ä°·ÄÅ·Äî·Ä∫·Ä∏·Ä°·Äï·Äº·ÄÑ·Ä∫·Äë·ÄΩ·ÄÄ·Ä∫·Äô·Äõ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫ ·Äï·Ä≠·Äê·Ä∫·Äë·Ä¨·Ä∏·Äô·Äö·Ä∫\r\n+        maxBounds={bounds}\r\n         style={{ height: \"100%\", width: \"100%\" }}\r\n-        crs={L.CRS.EPSG3857} // Standard GPS system\r\n       >\r\n-        {/* Real Map ·Ä°·ÄÖ·Ä¨·Ä∏ ·ÄÄ·Ä≠·ÄØ·Äö·Ä∫·Äï·Ä≠·ÄØ·ÄÑ·Ä∫ Image ·ÄÄ·Ä≠·ÄØ ·Äû·ÄØ·Ä∂·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ */}\r\n         <ImageOverlay\r\n           url=\"/images/prev_27.png\"\r\n           bounds={bounds}\r\n           zIndex={10}\r\n         />\r\n \r\n         <ChangeView center={position} />\r\n \r\n-        {/* User Character */}\r\n-        <Marker position={position} icon={charIcon} />\r\n+        {/* User Marker */}\r\n+        <Marker position={position} icon={charIcon} zIndexOffset={100} />\r\n \r\n-        {boxes?.map((box) => (\r\n-          <Marker key={box.id} position={[box.lat, box.lng]} icon={boxIcon}>\r\n-          </Marker>\r\n+        {/* Game Boxes - gameBoxes state ·ÄÄ·Ä≠·ÄØ ·Äû·ÄØ·Ä∂·Ä∏·Äõ·Äï·Ä´·Äô·Äö·Ä∫ */}\r\n+        {gameBoxes?.map((box) => (\r\n+          <Marker \r\n+            key={box.id} \r\n+            position={[box.lat, box.lng]} \r\n+            icon={boxIcon}\r\n+            eventHandlers={{\r\n+              click: () => handleCollect(box.id),\r\n+            }}\r\n+          />\r\n         ))}\r\n       </MapContainer>\r\n     </div>\r\n   );\r\n"
                },
                {
                    "date": 1768815150856,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,14 +35,36 @@\n     iconSize: [25, 41],\r\n     iconAnchor: [12, 41],\r\n   });\r\n \r\n-  const handleCollect = (id: number) => {\r\n+  // FreeMap.tsx ·Ä°·Äê·ÄΩ·ÄÑ·Ä∫·Ä∏·Äô·Äæ·Ä¨ ·Äï·Äº·ÄÑ·Ä∫·Äõ·Äî·Ä∫\r\n+const handleCollect = async (id: number) => {\r\n+  try {\r\n+    // ·ÅÅ·Åã Frontend UI ·ÄÄ·Ä≠·ÄØ ·Ä°·Äõ·ÄÑ·Ä∫ Update ·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n     setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n-    setScore(prev => prev + 10);\r\n-    alert(\"·Äû·Ä±·Äê·Äπ·Äê·Ä¨·Äõ·Äï·Äº·ÄÆ! Point +10\");\r\n-  };\r\n+    \r\n+    // ·ÅÇ·Åã Backend Database ·ÄÄ·Ä≠·ÄØ Update ·Äú·Äæ·Äô·Ä∫·Ä∏·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n+    const response = await fetch('/api/collect', {\r\n+      method: 'POST',\r\n+      headers: { 'Content-Type': 'application/json' },\r\n+      body: JSON.stringify({ \r\n+        userId: 1, // ·Äú·Ä±·Ä¨·Äú·Ä±·Ä¨·ÄÜ·Äö·Ä∫ User ID 1 ·Äú·Ä≠·ÄØ·Ä∑·Äï·Ä≤ ·Ä°·Äû·Ä±·Äë·Ä¨·Ä∏·Äï·Ä´\r\n+        pointsToAdd: 10 \r\n+      }),\r\n+    });\r\n \r\n+    const data = await response.json();\r\n+    \r\n+    if (data.success) {\r\n+      setScore(data.points); // Database ·ÄÄ·Äï·Äº·Äî·Ä∫·Äú·Ä¨·Äê·Ä≤·Ä∑ point ·Ä°·ÄÖ·ÄÖ·Ä∫·ÄÄ·Ä≠·ÄØ UI ·Äô·Äæ·Ä¨·Äï·Äº·Äô·Äö·Ä∫\r\n+      alert(\"Database ·Äô·Äæ·Ä¨ Point ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ! +10\");\r\n+    }\r\n+  } catch (error) {\r\n+    console.error(\"Collection error:\", error);\r\n+    alert(\"Point ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Ä°·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äæ·Ä≠·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫·Åã\");\r\n+  }\r\n+};\r\n+\r\n   useEffect(() => {\r\n     if (typeof window !== \"undefined\") {\r\n       const watchId = navigator.geolocation.watchPosition(\r\n         (pos) => setPosition([pos.coords.latitude, pos.coords.longitude]),\r\n"
                },
                {
                    "date": 1768815621107,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,25 @@\n export default function FreeMap({ boxes: initialBoxes }: { boxes: any[] }) {\r\n   const [position, setPosition] = useState<[number, number]>([16.8402, 96.1732]);\r\n   const [gameBoxes, setGameBoxes] = useState(initialBoxes);\r\n   const [score, setScore] = useState(0);\r\n+  const [inventory, setInventory] = useState<string[]>([]);\r\n+const [isInvOpen, setIsInvOpen] = useState(false);\r\n \r\n+const handleCollect = async (id: number, type: string) => {\r\n+  setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n+  \r\n+  const response = await fetch('/api/collect', {\r\n+    method: 'POST',\r\n+    body: JSON.stringify({ userId: 1, pointsToAdd: 10, itemName: type }),\r\n+  });\r\n+\r\n+  if (response.ok) {\r\n+    setInventory(prev => [...prev, type]); // UI ·Äô·Äæ·Ä¨ ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏ Item ·Äê·Ä≠·ÄØ·Ä∏·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n+    setScore(prev => prev + 10);\r\n+  }\r\n+};\r\n+\r\n   // ·ÅÅ·Åã Icon ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ Component ·Äë·Ä≤·Äû·Ä≠·ÄØ·Ä∑ ·Äõ·ÄΩ·Äæ·Ä±·Ä∑·Äï·Ä´\r\n   const charIcon = L.icon({\r\n     iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png\",\r\n     iconSize: [25, 41],\r\n"
                },
                {
                    "date": 1768815631184,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,34 +52,34 @@\n     iconAnchor: [12, 41],\r\n   });\r\n \r\n   // FreeMap.tsx ·Ä°·Äê·ÄΩ·ÄÑ·Ä∫·Ä∏·Äô·Äæ·Ä¨ ·Äï·Äº·ÄÑ·Ä∫·Äõ·Äî·Ä∫\r\n-const handleCollect = async (id: number) => {\r\n-  try {\r\n-    // ·ÅÅ·Åã Frontend UI ·ÄÄ·Ä≠·ÄØ ·Ä°·Äõ·ÄÑ·Ä∫ Update ·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n-    setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n+// const handleCollect = async (id: number) => {\r\n+//   try {\r\n+//     // ·ÅÅ·Åã Frontend UI ·ÄÄ·Ä≠·ÄØ ·Ä°·Äõ·ÄÑ·Ä∫ Update ·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n+//     setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n     \r\n-    // ·ÅÇ·Åã Backend Database ·ÄÄ·Ä≠·ÄØ Update ·Äú·Äæ·Äô·Ä∫·Ä∏·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n-    const response = await fetch('/api/collect', {\r\n-      method: 'POST',\r\n-      headers: { 'Content-Type': 'application/json' },\r\n-      body: JSON.stringify({ \r\n-        userId: 1, // ·Äú·Ä±·Ä¨·Äú·Ä±·Ä¨·ÄÜ·Äö·Ä∫ User ID 1 ·Äú·Ä≠·ÄØ·Ä∑·Äï·Ä≤ ·Ä°·Äû·Ä±·Äë·Ä¨·Ä∏·Äï·Ä´\r\n-        pointsToAdd: 10 \r\n-      }),\r\n-    });\r\n+//     // ·ÅÇ·Åã Backend Database ·ÄÄ·Ä≠·ÄØ Update ·Äú·Äæ·Äô·Ä∫·Ä∏·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n+//     const response = await fetch('/api/collect', {\r\n+//       method: 'POST',\r\n+//       headers: { 'Content-Type': 'application/json' },\r\n+//       body: JSON.stringify({ \r\n+//         userId: 1, // ·Äú·Ä±·Ä¨·Äú·Ä±·Ä¨·ÄÜ·Äö·Ä∫ User ID 1 ·Äú·Ä≠·ÄØ·Ä∑·Äï·Ä≤ ·Ä°·Äû·Ä±·Äë·Ä¨·Ä∏·Äï·Ä´\r\n+//         pointsToAdd: 10 \r\n+//       }),\r\n+//     });\r\n \r\n-    const data = await response.json();\r\n+//     const data = await response.json();\r\n     \r\n-    if (data.success) {\r\n-      setScore(data.points); // Database ·ÄÄ·Äï·Äº·Äî·Ä∫·Äú·Ä¨·Äê·Ä≤·Ä∑ point ·Ä°·ÄÖ·ÄÖ·Ä∫·ÄÄ·Ä≠·ÄØ UI ·Äô·Äæ·Ä¨·Äï·Äº·Äô·Äö·Ä∫\r\n-      alert(\"Database ·Äô·Äæ·Ä¨ Point ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ! +10\");\r\n-    }\r\n-  } catch (error) {\r\n-    console.error(\"Collection error:\", error);\r\n-    alert(\"Point ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Ä°·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äæ·Ä≠·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫·Åã\");\r\n-  }\r\n-};\r\n+//     if (data.success) {\r\n+//       setScore(data.points); // Database ·ÄÄ·Äï·Äº·Äî·Ä∫·Äú·Ä¨·Äê·Ä≤·Ä∑ point ·Ä°·ÄÖ·ÄÖ·Ä∫·ÄÄ·Ä≠·ÄØ UI ·Äô·Äæ·Ä¨·Äï·Äº·Äô·Äö·Ä∫\r\n+//       alert(\"Database ·Äô·Äæ·Ä¨ Point ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ! +10\");\r\n+//     }\r\n+//   } catch (error) {\r\n+//     console.error(\"Collection error:\", error);\r\n+//     alert(\"Point ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Ä°·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äæ·Ä≠·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫·Åã\");\r\n+//   }\r\n+// };\r\n \r\n   useEffect(() => {\r\n     if (typeof window !== \"undefined\") {\r\n       const watchId = navigator.geolocation.watchPosition(\r\n"
                },
                {
                    "date": 1768815653601,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,8 +92,35 @@\n   }, []);\r\n \r\n   return (\r\n     <div className=\"h-screen w-full bg-slate-900 relative\">\r\n+      <button \r\n+      onClick={() => setIsInvOpen(!isInvOpen)}\r\n+      className=\"absolute bottom-10 right-5 z-[1000] bg-yellow-500 p-4 rounded-full shadow-2xl text-2xl\"\r\n+    >\r\n+      üéí\r\n+    </button>\r\n+\r\n+    {/* Inventory Modal */}\r\n+    {isInvOpen && (\r\n+      <div className=\"absolute inset-0 z-[2000] bg-black/70 flex items-center justify-center p-5\">\r\n+        <div className=\"bg-white w-full max-w-md rounded-3xl p-6 text-black\">\r\n+          <div className=\"flex justify-between items-center mb-4\">\r\n+            <h2 className=\"text-xl font-bold\">·ÄÄ·Äª·ÄΩ·Äî·Ä∫·ÄØ·Äï·Ä∫·Åè ·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Ä°·Ä≠·Äê·Ä∫</h2>\r\n+            <button onClick={() => setIsInvOpen(false)} className=\"text-2xl\">‚úñ</button>\r\n+          </div>\r\n+          <div className=\"grid grid-cols-3 gap-4 overflow-y-auto max-h-60\">\r\n+            {inventory.length === 0 ? <p>·Äò·Ä¨·Äô·Äæ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´</p> : \r\n+              inventory.map((item, idx) => (\r\n+                <div key={idx} className=\"bg-gray-100 p-3 rounded-lg text-center text-sm\">\r\n+                  üéÅ <br/> {item}\r\n+                </div>\r\n+              ))\r\n+            }\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    )}\r\n       {/* Score UI */}\r\n       <div className=\"absolute top-5 left-5 z-[1000] bg-white p-3 rounded-xl shadow-lg text-black font-bold\">\r\n         Score: {score}\r\n       </div>\r\n"
                },
                {
                    "date": 1768815687406,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -148,9 +148,9 @@\n             key={box.id} \r\n             position={[box.lat, box.lng]} \r\n             icon={boxIcon}\r\n             eventHandlers={{\r\n-              click: () => handleCollect(box.id),\r\n+              click: () => handleCollect(box.id,box.type),\r\n             }}\r\n           />\r\n         ))}\r\n       </MapContainer>\r\n"
                },
                {
                    "date": 1768815873198,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,10 +17,9 @@\n   }, [center, map]);\r\n   return null;\r\n }\r\n \r\n-export default function FreeMap({ boxes: initialBoxes }: { boxes: any[] }) {\r\n-  const [position, setPosition] = useState<[number, number]>([16.8402, 96.1732]);\r\n+export default function FreeMap({ userId, username, boxes: initialBoxes }: { userId: number; username: string; boxes: any[] }) {  const [position, setPosition] = useState<[number, number]>([16.8402, 96.1732]);\r\n   const [gameBoxes, setGameBoxes] = useState(initialBoxes);\r\n   const [score, setScore] = useState(0);\r\n   const [inventory, setInventory] = useState<string[]>([]);\r\n const [isInvOpen, setIsInvOpen] = useState(false);\r\n"
                },
                {
                    "date": 1768815895529,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,11 +27,15 @@\n const handleCollect = async (id: number, type: string) => {\r\n   setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n   \r\n   const response = await fetch('/api/collect', {\r\n-    method: 'POST',\r\n-    body: JSON.stringify({ userId: 1, pointsToAdd: 10, itemName: type }),\r\n-  });\r\n+      method: 'POST',\r\n+      body: JSON.stringify({ \r\n+        userId: userId, // props ·ÄÄ·Äú·Ä¨·Äê·Ä≤·Ä∑ ID ·ÄÄ·Ä≠·ÄØ ·Äû·ÄØ·Ä∂·Ä∏·Äô·Äö·Ä∫\r\n+        pointsToAdd: 10, \r\n+        itemName: type \r\n+      }),\r\n+    });\r\n \r\n   if (response.ok) {\r\n     setInventory(prev => [...prev, type]); // UI ·Äô·Äæ·Ä¨ ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏ Item ·Äê·Ä≠·ÄØ·Ä∏·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n     setScore(prev => prev + 10);\r\n"
                },
                {
                    "date": 1768816007422,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,22 +24,28 @@\n   const [inventory, setInventory] = useState<string[]>([]);\r\n const [isInvOpen, setIsInvOpen] = useState(false);\r\n \r\n const handleCollect = async (id: number, type: string) => {\r\n+  // ·ÅÅ·Åã UI ·Äô·Äæ·Ä¨ ·Ä°·Äõ·ÄÑ·Ä∫·Äñ·Äª·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n   setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n   \r\n-  const response = await fetch('/api/collect', {\r\n+  try {\r\n+    const response = await fetch('/api/collect', {\r\n       method: 'POST',\r\n+      headers: { 'Content-Type': 'application/json' }, // ·Äí·Ä´·Äú·Ä±·Ä∏ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´\r\n       body: JSON.stringify({ \r\n-        userId: userId, // props ·ÄÄ·Äú·Ä¨·Äê·Ä≤·Ä∑ ID ·ÄÄ·Ä≠·ÄØ ·Äû·ÄØ·Ä∂·Ä∏·Äô·Äö·Ä∫\r\n+        userId: userId,\r\n         pointsToAdd: 10, \r\n         itemName: type \r\n       }),\r\n     });\r\n \r\n-  if (response.ok) {\r\n-    setInventory(prev => [...prev, type]); // UI ·Äô·Äæ·Ä¨ ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏ Item ·Äê·Ä≠·ÄØ·Ä∏·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n-    setScore(prev => prev + 10);\r\n+    if (response.ok) {\r\n+      setInventory(prev => [...prev, type]);\r\n+      setScore(prev => prev + 10);\r\n+    }\r\n+  } catch (err) {\r\n+    console.error(\"Save error:\", err);\r\n   }\r\n };\r\n \r\n   // ·ÅÅ·Åã Icon ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ Component ·Äë·Ä≤·Äû·Ä≠·ÄØ·Ä∑ ·Äõ·ÄΩ·Äæ·Ä±·Ä∑·Äï·Ä´\r\n"
                },
                {
                    "date": 1768816155304,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,8 +22,10 @@\n   const [gameBoxes, setGameBoxes] = useState(initialBoxes);\r\n   const [score, setScore] = useState(0);\r\n   const [inventory, setInventory] = useState<string[]>([]);\r\n const [isInvOpen, setIsInvOpen] = useState(false);\r\n+const [showModal, setShowModal] = useState(false);\r\n+const [lastItem, setLastItem] = useState(\"\");\r\n \r\n const handleCollect = async (id: number, type: string) => {\r\n   // ·ÅÅ·Åã UI ·Äô·Äæ·Ä¨ ·Ä°·Äõ·ÄÑ·Ä∫·Äñ·Äª·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n   setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n"
                },
                {
                    "date": 1768816170398,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,15 +26,14 @@\n const [showModal, setShowModal] = useState(false);\r\n const [lastItem, setLastItem] = useState(\"\");\r\n \r\n const handleCollect = async (id: number, type: string) => {\r\n-  // ·ÅÅ·Åã UI ·Äô·Äæ·Ä¨ ·Ä°·Äõ·ÄÑ·Ä∫·Äñ·Äª·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n   setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n   \r\n   try {\r\n     const response = await fetch('/api/collect', {\r\n       method: 'POST',\r\n-      headers: { 'Content-Type': 'application/json' }, // ·Äí·Ä´·Äú·Ä±·Ä∏ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´\r\n+      headers: { 'Content-Type': 'application/json' },\r\n       body: JSON.stringify({ \r\n         userId: userId,\r\n         pointsToAdd: 10, \r\n         itemName: type \r\n@@ -43,8 +42,12 @@\n \r\n     if (response.ok) {\r\n       setInventory(prev => [...prev, type]);\r\n       setScore(prev => prev + 10);\r\n+      \r\n+      // Modal ·Äï·Äº·Äõ·Äî·Ä∫\r\n+      setLastItem(type);\r\n+      setShowModal(true);\r\n     }\r\n   } catch (err) {\r\n     console.error(\"Save error:\", err);\r\n   }\r\n"
                },
                {
                    "date": 1768816189664,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -133,8 +133,29 @@\n           </div>\r\n         </div>\r\n       </div>\r\n     )}\r\n+    {showModal && (\r\n+  <div className=\"absolute inset-0 z-[3000] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-300\">\r\n+    <div className=\"bg-gradient-to-b from-yellow-400 to-yellow-600 p-1 rounded-2xl shadow-[0_0_50px_rgba(234,179,8,0.5)] transform animate-in zoom-in duration-300 scale-110\">\r\n+      <div className=\"bg-slate-900 text-white p-8 rounded-2xl text-center max-w-xs\">\r\n+        <div className=\"text-6xl mb-4 animate-bounce\">üéä</div>\r\n+        <h2 className=\"text-2xl font-black text-yellow-400 mb-2 italic\">CONGRATS!</h2>\r\n+        <p className=\"text-slate-300 mb-1\">·Äû·ÄÑ·Ä∫·Äõ·Äõ·Äæ·Ä≠·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äû·Ää·Ä∑·Ä∫·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äæ·Ä¨</p>\r\n+        <p className=\"text-xl font-bold text-white mb-6 underline decoration-yellow-500 decoration-4\">\r\n+          {lastItem}\r\n+        </p>\r\n+        \r\n+        <button \r\n+          onClick={() => setShowModal(false)}\r\n+          className=\"bg-yellow-500 hover:bg-yellow-400 text-black font-black py-3 px-8 rounded-full transition-transform active:scale-95 shadow-lg\"\r\n+        >\r\n+          ·Äú·ÄÄ·Ä∫·ÄÅ·Ä∂·Äô·Ää·Ä∫\r\n+        </button>\r\n+      </div>\r\n+    </div>\r\n+  </div>\r\n+)}\r\n       {/* Score UI */}\r\n       <div className=\"absolute top-5 left-5 z-[1000] bg-white p-3 rounded-xl shadow-lg text-black font-bold\">\r\n         Score: {score}\r\n       </div>\r\n"
                },
                {
                    "date": 1768816286659,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -104,8 +104,19 @@\n       return () => navigator.geolocation.clearWatch(watchId);\r\n     }\r\n   }, []);\r\n \r\n+  // ·Äô·ÄÆ·Äê·Ä¨ ·Ä°·ÄÄ·ÄΩ·Ä¨·Ä°·Äù·Ä±·Ä∏ ·Äê·ÄΩ·ÄÄ·Ä∫·Äõ·Äî·Ä∫ (Haversine Formula)\r\n+function getDistance(lat1: number, lon1: number, lat2: number, lon2: number) {\r\n+  const R = 6371e3; // ·ÄÄ·Äô·Äπ·Äò·Ä¨·Ä∑·Ä°·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äù·ÄÄ·Ä∫ (·Äô·ÄÆ·Äê·Ä¨)\r\n+  const dLat = (lat2 - lat1) * Math.PI / 180;\r\n+  const dLon = (lon2 - lon1) * Math.PI / 180;\r\n+  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\r\n+            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\r\n+            Math.sin(dLon/2) * Math.sin(dLon/2);\r\n+  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n+  return R * c; // ·Ä°·ÄÄ·ÄΩ·Ä¨·Ä°·Äù·Ä±·Ä∏ ·Äô·ÄÆ·Äê·Ä¨·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äë·ÄΩ·ÄÄ·Ä∫·Äú·Ä¨·Äô·Ää·Ä∫\r\n+}\r\n   return (\r\n     <div className=\"h-screen w-full bg-slate-900 relative\">\r\n       <button \r\n       onClick={() => setIsInvOpen(!isInvOpen)}\r\n"
                },
                {
                    "date": 1768816316824,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,48 +25,83 @@\n const [isInvOpen, setIsInvOpen] = useState(false);\r\n const [showModal, setShowModal] = useState(false);\r\n const [lastItem, setLastItem] = useState(\"\");\r\n \r\n-const handleCollect = async (id: number, type: string) => {\r\n-  setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n+// const handleCollect = async (id: number, type: string) => {\r\n+//   setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n   \r\n+//   try {\r\n+//     const response = await fetch('/api/collect', {\r\n+//       method: 'POST',\r\n+//       headers: { 'Content-Type': 'application/json' },\r\n+//       body: JSON.stringify({ \r\n+//         userId: userId,\r\n+//         pointsToAdd: 10, \r\n+//         itemName: type \r\n+//       }),\r\n+//     });\r\n+\r\n+//     if (response.ok) {\r\n+//       setInventory(prev => [...prev, type]);\r\n+//       setScore(prev => prev + 10);\r\n+      \r\n+//       // Modal ·Äï·Äº·Äõ·Äî·Ä∫\r\n+//       setLastItem(type);\r\n+//       setShowModal(true);\r\n+//     }\r\n+//   } catch (err) {\r\n+//     console.error(\"Save error:\", err);\r\n+//   }\r\n+// };\r\n+\r\n+  // ·ÅÅ·Åã Icon ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ Component ·Äë·Ä≤·Äû·Ä≠·ÄØ·Ä∑ ·Äõ·ÄΩ·Äæ·Ä±·Ä∑·Äï·Ä´\r\n+  const charIcon = L.icon({\r\n+    iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png\",\r\n+    iconSize: [25, 41],\r\n+    iconAnchor: [12, 41],\r\n+  });\r\n+\r\n+  const boxIcon = L.icon({\r\n+    iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png\",\r\n+    iconSize: [25, 41],\r\n+    iconAnchor: [12, 41],\r\n+  });\r\n+\r\n+  const handleCollect = async (box: any) => {\r\n+  // User ·Äõ·Ä≤·Ä∑ ·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠·Äî·Ä±·Äõ·Ä¨ ·Äî·Ä≤·Ä∑ Box ·Äõ·Ä≤·Ä∑·Äî·Ä±·Äõ·Ä¨ ·Ä°·ÄÄ·ÄΩ·Ä¨·Ä°·Äù·Ä±·Ä∏·ÄÄ·Ä≠·ÄØ ·Äê·ÄΩ·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n+  const distance = getDistance(position[0], position[1], box.lat, box.lng);\r\n+\r\n+  // ·ÅÖ ·Äô·ÄÆ·Äê·Ä¨·Äë·ÄÄ·Ä∫ ·Äù·Ä±·Ä∏·Äî·Ä±·Äõ·ÄÑ·Ä∫ ·ÄÄ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äô·Äï·Ä±·Ä∏·Äò·Ä∞·Ä∏\r\n+  if (distance > 5) {\r\n+    const roundedDist = Math.round(distance);\r\n+    alert(`·Äù·Ä±·Ä∏·Äú·ÄΩ·Äî·Ä∫·Ä∏·Äï·Ä´·Äû·Ä±·Ä∏·Äê·Äö·Ä∫! ·Äû·ÄÑ·Ä∫·ÄÄ ${roundedDist} ·Äô·ÄÆ·Äê·Ä¨ ·Ä°·ÄÄ·ÄΩ·Ä¨·Äô·Äæ·Ä¨ ·Äõ·Äæ·Ä≠·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫·Åã ·Ä°·Äî·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äú·Äô·Ä∫·Ä∏·Äú·Äª·Äæ·Ä±·Ä¨·ÄÄ·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äï·Ä´ üö∂‚Äç‚ôÇÔ∏è`);\r\n+    return;\r\n+  }\r\n+\r\n+  // ·Ä°·Äî·Ä¨·Ä∏·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äæ ·Ä°·Ä±·Ä¨·ÄÄ·Ä∫·ÄÄ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äê·Ä≤·Ä∑ Logic ·Ä°·Äú·ÄØ·Äï·Ä∫·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n+  setGameBoxes(prev => prev.filter(b => b.id !== box.id));\r\n+  \r\n   try {\r\n     const response = await fetch('/api/collect', {\r\n       method: 'POST',\r\n       headers: { 'Content-Type': 'application/json' },\r\n       body: JSON.stringify({ \r\n         userId: userId,\r\n         pointsToAdd: 10, \r\n-        itemName: type \r\n+        itemName: box.type \r\n       }),\r\n     });\r\n \r\n     if (response.ok) {\r\n-      setInventory(prev => [...prev, type]);\r\n+      setInventory(prev => [...prev, box.type]);\r\n       setScore(prev => prev + 10);\r\n-      \r\n-      // Modal ·Äï·Äº·Äõ·Äî·Ä∫\r\n-      setLastItem(type);\r\n+      setLastItem(box.type);\r\n       setShowModal(true);\r\n     }\r\n   } catch (err) {\r\n     console.error(\"Save error:\", err);\r\n   }\r\n };\r\n-\r\n-  // ·ÅÅ·Åã Icon ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ Component ·Äë·Ä≤·Äû·Ä≠·ÄØ·Ä∑ ·Äõ·ÄΩ·Äæ·Ä±·Ä∑·Äï·Ä´\r\n-  const charIcon = L.icon({\r\n-    iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png\",\r\n-    iconSize: [25, 41],\r\n-    iconAnchor: [12, 41],\r\n-  });\r\n-\r\n-  const boxIcon = L.icon({\r\n-    iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png\",\r\n-    iconSize: [25, 41],\r\n-    iconAnchor: [12, 41],\r\n-  });\r\n-\r\n   // FreeMap.tsx ·Ä°·Äê·ÄΩ·ÄÑ·Ä∫·Ä∏·Äô·Äæ·Ä¨ ·Äï·Äº·ÄÑ·Ä∫·Äõ·Äî·Ä∫\r\n // const handleCollect = async (id: number) => {\r\n //   try {\r\n //     // ·ÅÅ·Åã Frontend UI ·ÄÄ·Ä≠·ÄØ ·Ä°·Äõ·ÄÑ·Ä∫ Update ·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n@@ -115,8 +150,9 @@\n             Math.sin(dLon/2) * Math.sin(dLon/2);\r\n   const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n   return R * c; // ·Ä°·ÄÄ·ÄΩ·Ä¨·Ä°·Äù·Ä±·Ä∏ ·Äô·ÄÆ·Äê·Ä¨·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äë·ÄΩ·ÄÄ·Ä∫·Äú·Ä¨·Äô·Ää·Ä∫\r\n }\r\n+\r\n   return (\r\n     <div className=\"h-screen w-full bg-slate-900 relative\">\r\n       <button \r\n       onClick={() => setIsInvOpen(!isInvOpen)}\r\n"
                },
                {
                    "date": 1768816346519,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -230,10 +230,11 @@\n             key={box.id} \r\n             position={[box.lat, box.lng]} \r\n             icon={boxIcon}\r\n             eventHandlers={{\r\n-              click: () => handleCollect(box.id,box.type),\r\n-            }}\r\n+      // box ·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ ·Äï·Ä≠·ÄØ·Ä∑·Äï·Ä±·Ä∏·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n+      click: () => handleCollect(box),\r\n+    }}\r\n           />\r\n         ))}\r\n       </MapContainer>\r\n     </div>\r\n"
                },
                {
                    "date": 1768816355967,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -229,8 +229,9 @@\n           <Marker \r\n             key={box.id} \r\n             position={[box.lat, box.lng]} \r\n             icon={boxIcon}\r\n+           \r\n             eventHandlers={{\r\n       // box ·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ ·Äï·Ä≠·ÄØ·Ä∑·Äï·Ä±·Ä∏·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n       click: () => handleCollect(box),\r\n     }}\r\n"
                },
                {
                    "date": 1768817715620,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,9 +24,19 @@\n   const [inventory, setInventory] = useState<string[]>([]);\r\n const [isInvOpen, setIsInvOpen] = useState(false);\r\n const [showModal, setShowModal] = useState(false);\r\n const [lastItem, setLastItem] = useState(\"\");\r\n+  \r\n+  // gameBoxes ·ÄÄ·Ä≠·ÄØ ·Ä°·Äõ·ÄÑ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏ initialBoxes ·Äï·Ä±·Ä∏·Äë·Ä¨·Ä∏·Äô·Äö·Ä∫\r\n+  const [gameBoxes, setGameBoxes] = useState(initialBoxes || []);\r\n \r\n+  // initialBoxes ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·Ä≤·Äû·ÄΩ·Ä¨·Ä∏·Äõ·ÄÑ·Ä∫ (·Äí·Ä±·Äê·Ä¨ ·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äú·Ä¨·Äõ·ÄÑ·Ä∫) state ·Äë·Ä≤ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äñ·Ä≠·ÄØ·Ä∑·Äú·Ä≠·ÄØ·Äê·Äö·Ä∫\r\n+  useEffect(() => {\r\n+    if (initialBoxes) {\r\n+      setGameBoxes(initialBoxes);\r\n+    }\r\n+  }, [initialBoxes]);\r\n+\r\n // const handleCollect = async (id: number, type: string) => {\r\n //   setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n   \r\n //   try {\r\n"
                },
                {
                    "date": 1768817720852,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,8 @@\n   return null;\r\n }\r\n \r\n export default function FreeMap({ userId, username, boxes: initialBoxes }: { userId: number; username: string; boxes: any[] }) {  const [position, setPosition] = useState<[number, number]>([16.8402, 96.1732]);\r\n-  const [gameBoxes, setGameBoxes] = useState(initialBoxes);\r\n   const [score, setScore] = useState(0);\r\n   const [inventory, setInventory] = useState<string[]>([]);\r\n const [isInvOpen, setIsInvOpen] = useState(false);\r\n const [showModal, setShowModal] = useState(false);\r\n"
                },
                {
                    "date": 1768817808882,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,10 +5,10 @@\n import { useEffect, useState } from \"react\";\r\n \r\n // Boundary ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ ·Ä°·Äï·Äº·ÄÑ·Ä∫·Äô·Äæ·Ä¨ ·Äë·Ä¨·Ä∏·Äú·Ä≠·ÄØ·Ä∑·Äõ·Äï·Ä´·Äê·Äö·Ä∫\r\n const bounds: L.LatLngBoundsExpression = [\r\n-  [16.8405, 96.1730],\r\n-  [16.8400, 96.1735],\r\n+  [16.8120, 96.1330], // Top-Left (·Äû·ÄÑ·Ä∑·Ä∫·Äî·Ä±·Äõ·Ä¨·Äë·ÄÄ·Ä∫ ·Äî·Ää·Ä∫·Ä∏·Äî·Ää·Ä∫·Ä∏·Äï·Ä≠·ÄØ·ÄÄ·Äª·Äö·Ä∫·Äï·Ä±·Ä∏·Äë·Ä¨·Ä∏·Äê·Äö·Ä∫)\r\n+  [16.8030, 96.1420],\r\n ];\r\n \r\n function ChangeView({ center }: { center: [number, number] }) {\r\n   const map = useMap();\r\n"
                },
                {
                    "date": 1768817853894,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -230,23 +230,21 @@\n \r\n         <ChangeView center={position} />\r\n \r\n         {/* User Marker */}\r\n-        <Marker position={position} icon={charIcon} zIndexOffset={100} />\r\n+       <Marker position={position} icon={charIcon} zIndexOffset={1000} />\r\n \r\n-        {/* Game Boxes - gameBoxes state ·ÄÄ·Ä≠·ÄØ ·Äû·ÄØ·Ä∂·Ä∏·Äõ·Äï·Ä´·Äô·Äö·Ä∫ */}\r\n-        {gameBoxes?.map((box) => (\r\n-          <Marker \r\n-            key={box.id} \r\n-            position={[box.lat, box.lng]} \r\n-            icon={boxIcon}\r\n-           \r\n-            eventHandlers={{\r\n-      // box ·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ ·Äï·Ä≠·ÄØ·Ä∑·Äï·Ä±·Ä∏·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n+{gameBoxes?.map((box) => (\r\n+  <Marker \r\n+    key={box.id} \r\n+    position={[box.lat, box.lng]} \r\n+    icon={boxIcon}\r\n+    zIndexOffset={500} // Image ·Äõ·Ä≤·Ä∑ ·Ä°·Äï·Ä±·Ä´·Ä∫·Äô·Äæ·Ä¨ ·Äï·Ä±·Ä´·Ä∫·Äî·Ä±·Äñ·Ä≠·ÄØ·Ä∑\r\n+    eventHandlers={{\r\n       click: () => handleCollect(box),\r\n     }}\r\n-          />\r\n-        ))}\r\n+  />\r\n+))}\r\n       </MapContainer>\r\n     </div>\r\n   );\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1768817925214,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,15 +17,15 @@\n   }, [center, map]);\r\n   return null;\r\n }\r\n \r\n-export default function FreeMap({ userId, username, boxes: initialBoxes }: { userId: number; username: string; boxes: any[] }) {  const [position, setPosition] = useState<[number, number]>([16.8402, 96.1732]);\r\n+export default function FreeMap({ userId, username, boxes: initialBoxes }: { userId: number; username: string; boxes: any[] }) {  const [position, setPosition] = useState<[number, number]>([16.807694, 96.137832]);\r\n   const [score, setScore] = useState(0);\r\n   const [inventory, setInventory] = useState<string[]>([]);\r\n const [isInvOpen, setIsInvOpen] = useState(false);\r\n const [showModal, setShowModal] = useState(false);\r\n const [lastItem, setLastItem] = useState(\"\");\r\n-  \r\n+  const [position, setPosition] = useState<[number, number]>([16.807694, 96.137832]);\r\n   // gameBoxes ·ÄÄ·Ä≠·ÄØ ·Ä°·Äõ·ÄÑ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏ initialBoxes ·Äï·Ä±·Ä∏·Äë·Ä¨·Ä∏·Äô·Äö·Ä∫\r\n   const [gameBoxes, setGameBoxes] = useState(initialBoxes || []);\r\n \r\n   // initialBoxes ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·Ä≤·Äû·ÄΩ·Ä¨·Ä∏·Äõ·ÄÑ·Ä∫ (·Äí·Ä±·Äê·Ä¨ ·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äú·Ä¨·Äõ·ÄÑ·Ä∫) state ·Äë·Ä≤ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äñ·Ä≠·ÄØ·Ä∑·Äú·Ä≠·ÄØ·Äê·Äö·Ä∫\r\n"
                },
                {
                    "date": 1768817930805,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,9 +17,10 @@\n   }, [center, map]);\r\n   return null;\r\n }\r\n \r\n-export default function FreeMap({ userId, username, boxes: initialBoxes }: { userId: number; username: string; boxes: any[] }) {  const [position, setPosition] = useState<[number, number]>([16.807694, 96.137832]);\r\n+export default function FreeMap({ userId, username, boxes: initialBoxes }: { userId: number; username: string; boxes: any[] }) { \r\n+   const [position, setPosition] = useState<[number, number]>([16.807694, 96.137832]);\r\n   const [score, setScore] = useState(0);\r\n   const [inventory, setInventory] = useState<string[]>([]);\r\n const [isInvOpen, setIsInvOpen] = useState(false);\r\n const [showModal, setShowModal] = useState(false);\r\n"
                },
                {
                    "date": 1768817960709,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,14 +1,20 @@\n \"use client\";\r\n-import { MapContainer, ImageOverlay, Marker, useMap, useMapEvents } from \"react-leaflet\";\r\n+import {\r\n+  MapContainer,\r\n+  ImageOverlay,\r\n+  Marker,\r\n+  useMap,\r\n+  useMapEvents,\r\n+} from \"react-leaflet\";\r\n import \"leaflet/dist/leaflet.css\";\r\n import L from \"leaflet\";\r\n import { useEffect, useState } from \"react\";\r\n \r\n // Boundary ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ ·Ä°·Äï·Äº·ÄÑ·Ä∫·Äô·Äæ·Ä¨ ·Äë·Ä¨·Ä∏·Äú·Ä≠·ÄØ·Ä∑·Äõ·Äï·Ä´·Äê·Äö·Ä∫\r\n const bounds: L.LatLngBoundsExpression = [\r\n-  [16.8120, 96.1330], // Top-Left (·Äû·ÄÑ·Ä∑·Ä∫·Äî·Ä±·Äõ·Ä¨·Äë·ÄÄ·Ä∫ ·Äî·Ää·Ä∫·Ä∏·Äî·Ää·Ä∫·Ä∏·Äï·Ä≠·ÄØ·ÄÄ·Äª·Äö·Ä∫·Äï·Ä±·Ä∏·Äë·Ä¨·Ä∏·Äê·Äö·Ä∫)\r\n-  [16.8030, 96.1420],\r\n+  [16.812, 96.133], // Top-Left (·Äû·ÄÑ·Ä∑·Ä∫·Äî·Ä±·Äõ·Ä¨·Äë·ÄÄ·Ä∫ ·Äî·Ää·Ä∫·Ä∏·Äî·Ää·Ä∫·Ä∏·Äï·Ä≠·ÄØ·ÄÄ·Äª·Äö·Ä∫·Äï·Ä±·Ä∏·Äë·Ä¨·Ä∏·Äê·Äö·Ä∫)\r\n+  [16.803, 96.142],\r\n ];\r\n \r\n function ChangeView({ center }: { center: [number, number] }) {\r\n   const map = useMap();\r\n@@ -17,15 +23,25 @@\n   }, [center, map]);\r\n   return null;\r\n }\r\n \r\n-export default function FreeMap({ userId, username, boxes: initialBoxes }: { userId: number; username: string; boxes: any[] }) { \r\n-   const [position, setPosition] = useState<[number, number]>([16.807694, 96.137832]);\r\n+export default function FreeMap({\r\n+  userId,\r\n+  username,\r\n+  boxes: initialBoxes,\r\n+}: {\r\n+  userId: number;\r\n+  username: string;\r\n+  boxes: any[];\r\n+}) {\r\n+  const [position, setPosition] = useState<[number, number]>([\r\n+    16.807694, 96.137832,\r\n+  ]);\r\n   const [score, setScore] = useState(0);\r\n   const [inventory, setInventory] = useState<string[]>([]);\r\n-const [isInvOpen, setIsInvOpen] = useState(false);\r\n-const [showModal, setShowModal] = useState(false);\r\n-const [lastItem, setLastItem] = useState(\"\");\r\n+  const [isInvOpen, setIsInvOpen] = useState(false);\r\n+  const [showModal, setShowModal] = useState(false);\r\n+  const [lastItem, setLastItem] = useState(\"\");\r\n   // gameBoxes ·ÄÄ·Ä≠·ÄØ ·Ä°·Äõ·ÄÑ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏ initialBoxes ·Äï·Ä±·Ä∏·Äë·Ä¨·Ä∏·Äô·Äö·Ä∫\r\n   const [gameBoxes, setGameBoxes] = useState(initialBoxes || []);\r\n \r\n   // initialBoxes ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·Ä≤·Äû·ÄΩ·Ä¨·Ä∏·Äõ·ÄÑ·Ä∫ (·Äí·Ä±·Äê·Ä¨ ·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äú·Ä¨·Äõ·ÄÑ·Ä∫) state ·Äë·Ä≤ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äñ·Ä≠·ÄØ·Ä∑·Äú·Ä≠·ÄØ·Äê·Äö·Ä∫\r\n@@ -34,217 +50,229 @@\n       setGameBoxes(initialBoxes);\r\n     }\r\n   }, [initialBoxes]);\r\n \r\n-// const handleCollect = async (id: number, type: string) => {\r\n-//   setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n-  \r\n-//   try {\r\n-//     const response = await fetch('/api/collect', {\r\n-//       method: 'POST',\r\n-//       headers: { 'Content-Type': 'application/json' },\r\n-//       body: JSON.stringify({ \r\n-//         userId: userId,\r\n-//         pointsToAdd: 10, \r\n-//         itemName: type \r\n-//       }),\r\n-//     });\r\n+  // const handleCollect = async (id: number, type: string) => {\r\n+  //   setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n \r\n-//     if (response.ok) {\r\n-//       setInventory(prev => [...prev, type]);\r\n-//       setScore(prev => prev + 10);\r\n-      \r\n-//       // Modal ·Äï·Äº·Äõ·Äî·Ä∫\r\n-//       setLastItem(type);\r\n-//       setShowModal(true);\r\n-//     }\r\n-//   } catch (err) {\r\n-//     console.error(\"Save error:\", err);\r\n-//   }\r\n-// };\r\n+  //   try {\r\n+  //     const response = await fetch('/api/collect', {\r\n+  //       method: 'POST',\r\n+  //       headers: { 'Content-Type': 'application/json' },\r\n+  //       body: JSON.stringify({\r\n+  //         userId: userId,\r\n+  //         pointsToAdd: 10,\r\n+  //         itemName: type\r\n+  //       }),\r\n+  //     });\r\n \r\n+  //     if (response.ok) {\r\n+  //       setInventory(prev => [...prev, type]);\r\n+  //       setScore(prev => prev + 10);\r\n+\r\n+  //       // Modal ·Äï·Äº·Äõ·Äî·Ä∫\r\n+  //       setLastItem(type);\r\n+  //       setShowModal(true);\r\n+  //     }\r\n+  //   } catch (err) {\r\n+  //     console.error(\"Save error:\", err);\r\n+  //   }\r\n+  // };\r\n+\r\n   // ·ÅÅ·Åã Icon ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ Component ·Äë·Ä≤·Äû·Ä≠·ÄØ·Ä∑ ·Äõ·ÄΩ·Äæ·Ä±·Ä∑·Äï·Ä´\r\n   const charIcon = L.icon({\r\n-    iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png\",\r\n+    iconUrl:\r\n+      \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png\",\r\n     iconSize: [25, 41],\r\n     iconAnchor: [12, 41],\r\n   });\r\n \r\n   const boxIcon = L.icon({\r\n-    iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png\",\r\n+    iconUrl:\r\n+      \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png\",\r\n     iconSize: [25, 41],\r\n     iconAnchor: [12, 41],\r\n   });\r\n \r\n   const handleCollect = async (box: any) => {\r\n-  // User ·Äõ·Ä≤·Ä∑ ·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠·Äî·Ä±·Äõ·Ä¨ ·Äî·Ä≤·Ä∑ Box ·Äõ·Ä≤·Ä∑·Äî·Ä±·Äõ·Ä¨ ·Ä°·ÄÄ·ÄΩ·Ä¨·Ä°·Äù·Ä±·Ä∏·ÄÄ·Ä≠·ÄØ ·Äê·ÄΩ·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n-  const distance = getDistance(position[0], position[1], box.lat, box.lng);\r\n+    // User ·Äõ·Ä≤·Ä∑ ·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠·Äî·Ä±·Äõ·Ä¨ ·Äî·Ä≤·Ä∑ Box ·Äõ·Ä≤·Ä∑·Äî·Ä±·Äõ·Ä¨ ·Ä°·ÄÄ·ÄΩ·Ä¨·Ä°·Äù·Ä±·Ä∏·ÄÄ·Ä≠·ÄØ ·Äê·ÄΩ·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n+    const distance = getDistance(position[0], position[1], box.lat, box.lng);\r\n \r\n-  // ·ÅÖ ·Äô·ÄÆ·Äê·Ä¨·Äë·ÄÄ·Ä∫ ·Äù·Ä±·Ä∏·Äî·Ä±·Äõ·ÄÑ·Ä∫ ·ÄÄ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äô·Äï·Ä±·Ä∏·Äò·Ä∞·Ä∏\r\n-  if (distance > 5) {\r\n-    const roundedDist = Math.round(distance);\r\n-    alert(`·Äù·Ä±·Ä∏·Äú·ÄΩ·Äî·Ä∫·Ä∏·Äï·Ä´·Äû·Ä±·Ä∏·Äê·Äö·Ä∫! ·Äû·ÄÑ·Ä∫·ÄÄ ${roundedDist} ·Äô·ÄÆ·Äê·Ä¨ ·Ä°·ÄÄ·ÄΩ·Ä¨·Äô·Äæ·Ä¨ ·Äõ·Äæ·Ä≠·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫·Åã ·Ä°·Äî·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äú·Äô·Ä∫·Ä∏·Äú·Äª·Äæ·Ä±·Ä¨·ÄÄ·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äï·Ä´ üö∂‚Äç‚ôÇÔ∏è`);\r\n-    return;\r\n-  }\r\n+    // ·ÅÖ ·Äô·ÄÆ·Äê·Ä¨·Äë·ÄÄ·Ä∫ ·Äù·Ä±·Ä∏·Äî·Ä±·Äõ·ÄÑ·Ä∫ ·ÄÄ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äô·Äï·Ä±·Ä∏·Äò·Ä∞·Ä∏\r\n+    if (distance > 5) {\r\n+      const roundedDist = Math.round(distance);\r\n+      alert(\r\n+        `·Äù·Ä±·Ä∏·Äú·ÄΩ·Äî·Ä∫·Ä∏·Äï·Ä´·Äû·Ä±·Ä∏·Äê·Äö·Ä∫! ·Äû·ÄÑ·Ä∫·ÄÄ ${roundedDist} ·Äô·ÄÆ·Äê·Ä¨ ·Ä°·ÄÄ·ÄΩ·Ä¨·Äô·Äæ·Ä¨ ·Äõ·Äæ·Ä≠·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫·Åã ·Ä°·Äî·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äú·Äô·Ä∫·Ä∏·Äú·Äª·Äæ·Ä±·Ä¨·ÄÄ·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äï·Ä´ üö∂‚Äç‚ôÇÔ∏è`,\r\n+      );\r\n+      return;\r\n+    }\r\n \r\n-  // ·Ä°·Äî·Ä¨·Ä∏·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äæ ·Ä°·Ä±·Ä¨·ÄÄ·Ä∫·ÄÄ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äê·Ä≤·Ä∑ Logic ·Ä°·Äú·ÄØ·Äï·Ä∫·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n-  setGameBoxes(prev => prev.filter(b => b.id !== box.id));\r\n-  \r\n-  try {\r\n-    const response = await fetch('/api/collect', {\r\n-      method: 'POST',\r\n-      headers: { 'Content-Type': 'application/json' },\r\n-      body: JSON.stringify({ \r\n-        userId: userId,\r\n-        pointsToAdd: 10, \r\n-        itemName: box.type \r\n-      }),\r\n-    });\r\n+    // ·Ä°·Äî·Ä¨·Ä∏·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äæ ·Ä°·Ä±·Ä¨·ÄÄ·Ä∫·ÄÄ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äê·Ä≤·Ä∑ Logic ·Ä°·Äú·ÄØ·Äï·Ä∫·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n+    setGameBoxes((prev) => prev.filter((b) => b.id !== box.id));\r\n \r\n-    if (response.ok) {\r\n-      setInventory(prev => [...prev, box.type]);\r\n-      setScore(prev => prev + 10);\r\n-      setLastItem(box.type);\r\n-      setShowModal(true);\r\n+    try {\r\n+      const response = await fetch(\"/api/collect\", {\r\n+        method: \"POST\",\r\n+        headers: { \"Content-Type\": \"application/json\" },\r\n+        body: JSON.stringify({\r\n+          userId: userId,\r\n+          pointsToAdd: 10,\r\n+          itemName: box.type,\r\n+        }),\r\n+      });\r\n+\r\n+      if (response.ok) {\r\n+        setInventory((prev) => [...prev, box.type]);\r\n+        setScore((prev) => prev + 10);\r\n+        setLastItem(box.type);\r\n+        setShowModal(true);\r\n+      }\r\n+    } catch (err) {\r\n+      console.error(\"Save error:\", err);\r\n     }\r\n-  } catch (err) {\r\n-    console.error(\"Save error:\", err);\r\n-  }\r\n-};\r\n+  };\r\n   // FreeMap.tsx ·Ä°·Äê·ÄΩ·ÄÑ·Ä∫·Ä∏·Äô·Äæ·Ä¨ ·Äï·Äº·ÄÑ·Ä∫·Äõ·Äî·Ä∫\r\n-// const handleCollect = async (id: number) => {\r\n-//   try {\r\n-//     // ·ÅÅ·Åã Frontend UI ·ÄÄ·Ä≠·ÄØ ·Ä°·Äõ·ÄÑ·Ä∫ Update ·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n-//     setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n-    \r\n-//     // ·ÅÇ·Åã Backend Database ·ÄÄ·Ä≠·ÄØ Update ·Äú·Äæ·Äô·Ä∫·Ä∏·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n-//     const response = await fetch('/api/collect', {\r\n-//       method: 'POST',\r\n-//       headers: { 'Content-Type': 'application/json' },\r\n-//       body: JSON.stringify({ \r\n-//         userId: 1, // ·Äú·Ä±·Ä¨·Äú·Ä±·Ä¨·ÄÜ·Äö·Ä∫ User ID 1 ·Äú·Ä≠·ÄØ·Ä∑·Äï·Ä≤ ·Ä°·Äû·Ä±·Äë·Ä¨·Ä∏·Äï·Ä´\r\n-//         pointsToAdd: 10 \r\n-//       }),\r\n-//     });\r\n+  // const handleCollect = async (id: number) => {\r\n+  //   try {\r\n+  //     // ·ÅÅ·Åã Frontend UI ·ÄÄ·Ä≠·ÄØ ·Ä°·Äõ·ÄÑ·Ä∫ Update ·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n+  //     setGameBoxes(prev => prev.filter(b => b.id !== id));\r\n \r\n-//     const data = await response.json();\r\n-    \r\n-//     if (data.success) {\r\n-//       setScore(data.points); // Database ·ÄÄ·Äï·Äº·Äî·Ä∫·Äú·Ä¨·Äê·Ä≤·Ä∑ point ·Ä°·ÄÖ·ÄÖ·Ä∫·ÄÄ·Ä≠·ÄØ UI ·Äô·Äæ·Ä¨·Äï·Äº·Äô·Äö·Ä∫\r\n-//       alert(\"Database ·Äô·Äæ·Ä¨ Point ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ! +10\");\r\n-//     }\r\n-//   } catch (error) {\r\n-//     console.error(\"Collection error:\", error);\r\n-//     alert(\"Point ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Ä°·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äæ·Ä≠·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫·Åã\");\r\n-//   }\r\n-// };\r\n+  //     // ·ÅÇ·Åã Backend Database ·ÄÄ·Ä≠·ÄØ Update ·Äú·Äæ·Äô·Ä∫·Ä∏·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫\r\n+  //     const response = await fetch('/api/collect', {\r\n+  //       method: 'POST',\r\n+  //       headers: { 'Content-Type': 'application/json' },\r\n+  //       body: JSON.stringify({\r\n+  //         userId: 1, // ·Äú·Ä±·Ä¨·Äú·Ä±·Ä¨·ÄÜ·Äö·Ä∫ User ID 1 ·Äú·Ä≠·ÄØ·Ä∑·Äï·Ä≤ ·Ä°·Äû·Ä±·Äë·Ä¨·Ä∏·Äï·Ä´\r\n+  //         pointsToAdd: 10\r\n+  //       }),\r\n+  //     });\r\n \r\n+  //     const data = await response.json();\r\n+\r\n+  //     if (data.success) {\r\n+  //       setScore(data.points); // Database ·ÄÄ·Äï·Äº·Äî·Ä∫·Äú·Ä¨·Äê·Ä≤·Ä∑ point ·Ä°·ÄÖ·ÄÖ·Ä∫·ÄÄ·Ä≠·ÄØ UI ·Äô·Äæ·Ä¨·Äï·Äº·Äô·Äö·Ä∫\r\n+  //       alert(\"Database ·Äô·Äæ·Ä¨ Point ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ! +10\");\r\n+  //     }\r\n+  //   } catch (error) {\r\n+  //     console.error(\"Collection error:\", error);\r\n+  //     alert(\"Point ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Ä°·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äæ·Ä≠·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫·Åã\");\r\n+  //   }\r\n+  // };\r\n+\r\n   useEffect(() => {\r\n     if (typeof window !== \"undefined\") {\r\n       const watchId = navigator.geolocation.watchPosition(\r\n         (pos) => setPosition([pos.coords.latitude, pos.coords.longitude]),\r\n         (err) => console.error(err),\r\n-        { enableHighAccuracy: true }\r\n+        { enableHighAccuracy: true },\r\n       );\r\n       return () => navigator.geolocation.clearWatch(watchId);\r\n     }\r\n   }, []);\r\n \r\n   // ·Äô·ÄÆ·Äê·Ä¨ ·Ä°·ÄÄ·ÄΩ·Ä¨·Ä°·Äù·Ä±·Ä∏ ·Äê·ÄΩ·ÄÄ·Ä∫·Äõ·Äî·Ä∫ (Haversine Formula)\r\n-function getDistance(lat1: number, lon1: number, lat2: number, lon2: number) {\r\n-  const R = 6371e3; // ·ÄÄ·Äô·Äπ·Äò·Ä¨·Ä∑·Ä°·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äù·ÄÄ·Ä∫ (·Äô·ÄÆ·Äê·Ä¨)\r\n-  const dLat = (lat2 - lat1) * Math.PI / 180;\r\n-  const dLon = (lon2 - lon1) * Math.PI / 180;\r\n-  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\r\n-            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\r\n-            Math.sin(dLon/2) * Math.sin(dLon/2);\r\n-  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n-  return R * c; // ·Ä°·ÄÄ·ÄΩ·Ä¨·Ä°·Äù·Ä±·Ä∏ ·Äô·ÄÆ·Äê·Ä¨·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äë·ÄΩ·ÄÄ·Ä∫·Äú·Ä¨·Äô·Ää·Ä∫\r\n-}\r\n+  function getDistance(lat1: number, lon1: number, lat2: number, lon2: number) {\r\n\\ No newline at end of file\n+    const R = 6371e3; // ·ÄÄ·Äô·Äπ·Äò·Ä¨·Ä∑·Ä°·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äù·ÄÄ·Ä∫ (·Äô·ÄÆ·Äê·Ä¨)\r\n+    const dLat = ((lat2 - lat1) * Math.PI) / 180;\r\n+    const dLon = ((lon2 - lon1) * Math.PI) / 180;\r\n+    const a =\r\n+      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n+      Math.cos((lat1 * Math.PI) / 180) *\r\n+        Math.cos((lat2 * Math.PI) / 180) *\r\n+        Math.sin(dLon / 2) *\r\n+        Math.sin(dLon / 2);\r\n+    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n+    return R * c; // ·Ä°·ÄÄ·ÄΩ·Ä¨·Ä°·Äù·Ä±·Ä∏ ·Äô·ÄÆ·Äê·Ä¨·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äë·ÄΩ·ÄÄ·Ä∫·Äú·Ä¨·Äô·Ää·Ä∫\r\n+  }\r\n \r\n   return (\r\n     <div className=\"h-screen w-full bg-slate-900 relative\">\r\n-      <button \r\n-      onClick={() => setIsInvOpen(!isInvOpen)}\r\n-      className=\"absolute bottom-10 right-5 z-[1000] bg-yellow-500 p-4 rounded-full shadow-2xl text-2xl\"\r\n-    >\r\n-      üéí\r\n-    </button>\r\n+      <button\r\n+        onClick={() => setIsInvOpen(!isInvOpen)}\r\n+        className=\"absolute bottom-10 right-5 z-[1000] bg-yellow-500 p-4 rounded-full shadow-2xl text-2xl\"\r\n+      >\r\n+        üéí\r\n+      </button>\r\n \r\n-    {/* Inventory Modal */}\r\n-    {isInvOpen && (\r\n-      <div className=\"absolute inset-0 z-[2000] bg-black/70 flex items-center justify-center p-5\">\r\n-        <div className=\"bg-white w-full max-w-md rounded-3xl p-6 text-black\">\r\n-          <div className=\"flex justify-between items-center mb-4\">\r\n-            <h2 className=\"text-xl font-bold\">·ÄÄ·Äª·ÄΩ·Äî·Ä∫·ÄØ·Äï·Ä∫·Åè ·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Ä°·Ä≠·Äê·Ä∫</h2>\r\n-            <button onClick={() => setIsInvOpen(false)} className=\"text-2xl\">‚úñ</button>\r\n+      {/* Inventory Modal */}\r\n+      {isInvOpen && (\r\n+        <div className=\"absolute inset-0 z-[2000] bg-black/70 flex items-center justify-center p-5\">\r\n+          <div className=\"bg-white w-full max-w-md rounded-3xl p-6 text-black\">\r\n+            <div className=\"flex justify-between items-center mb-4\">\r\n+              <h2 className=\"text-xl font-bold\">·ÄÄ·Äª·ÄΩ·Äî·Ä∫·ÄØ·Äï·Ä∫·Åè ·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Ä°·Ä≠·Äê·Ä∫</h2>\r\n+              <button onClick={() => setIsInvOpen(false)} className=\"text-2xl\">\r\n+                ‚úñ\r\n+              </button>\r\n+            </div>\r\n+            <div className=\"grid grid-cols-3 gap-4 overflow-y-auto max-h-60\">\r\n+              {inventory.length === 0 ? (\r\n+                <p>·Äò·Ä¨·Äô·Äæ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´</p>\r\n+              ) : (\r\n+                inventory.map((item, idx) => (\r\n+                  <div\r\n+                    key={idx}\r\n+                    className=\"bg-gray-100 p-3 rounded-lg text-center text-sm\"\r\n+                  >\r\n+                    üéÅ <br /> {item}\r\n+                  </div>\r\n+                ))\r\n+              )}\r\n+            </div>\r\n           </div>\r\n-          <div className=\"grid grid-cols-3 gap-4 overflow-y-auto max-h-60\">\r\n-            {inventory.length === 0 ? <p>·Äò·Ä¨·Äô·Äæ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´</p> : \r\n-              inventory.map((item, idx) => (\r\n-                <div key={idx} className=\"bg-gray-100 p-3 rounded-lg text-center text-sm\">\r\n-                  üéÅ <br/> {item}\r\n-                </div>\r\n-              ))\r\n-            }\r\n+        </div>\r\n+      )}\r\n+      {showModal && (\r\n+        <div className=\"absolute inset-0 z-[3000] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-300\">\r\n+          <div className=\"bg-gradient-to-b from-yellow-400 to-yellow-600 p-1 rounded-2xl shadow-[0_0_50px_rgba(234,179,8,0.5)] transform animate-in zoom-in duration-300 scale-110\">\r\n+            <div className=\"bg-slate-900 text-white p-8 rounded-2xl text-center max-w-xs\">\r\n+              <div className=\"text-6xl mb-4 animate-bounce\">üéä</div>\r\n+              <h2 className=\"text-2xl font-black text-yellow-400 mb-2 italic\">\r\n+                CONGRATS!\r\n+              </h2>\r\n+              <p className=\"text-slate-300 mb-1\">·Äû·ÄÑ·Ä∫·Äõ·Äõ·Äæ·Ä≠·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äû·Ää·Ä∑·Ä∫·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äæ·Ä¨</p>\r\n+              <p className=\"text-xl font-bold text-white mb-6 underline decoration-yellow-500 decoration-4\">\r\n+                {lastItem}\r\n+              </p>\r\n+\r\n+              <button\r\n+                onClick={() => setShowModal(false)}\r\n+                className=\"bg-yellow-500 hover:bg-yellow-400 text-black font-black py-3 px-8 rounded-full transition-transform active:scale-95 shadow-lg\"\r\n+              >\r\n+                ·Äú·ÄÄ·Ä∫·ÄÅ·Ä∂·Äô·Ää·Ä∫\r\n+              </button>\r\n+            </div>\r\n           </div>\r\n         </div>\r\n-      </div>\r\n-    )}\r\n-    {showModal && (\r\n-  <div className=\"absolute inset-0 z-[3000] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-300\">\r\n-    <div className=\"bg-gradient-to-b from-yellow-400 to-yellow-600 p-1 rounded-2xl shadow-[0_0_50px_rgba(234,179,8,0.5)] transform animate-in zoom-in duration-300 scale-110\">\r\n-      <div className=\"bg-slate-900 text-white p-8 rounded-2xl text-center max-w-xs\">\r\n-        <div className=\"text-6xl mb-4 animate-bounce\">üéä</div>\r\n-        <h2 className=\"text-2xl font-black text-yellow-400 mb-2 italic\">CONGRATS!</h2>\r\n-        <p className=\"text-slate-300 mb-1\">·Äû·ÄÑ·Ä∫·Äõ·Äõ·Äæ·Ä≠·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äû·Ää·Ä∑·Ä∫·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äæ·Ä¨</p>\r\n-        <p className=\"text-xl font-bold text-white mb-6 underline decoration-yellow-500 decoration-4\">\r\n-          {lastItem}\r\n-        </p>\r\n-        \r\n-        <button \r\n-          onClick={() => setShowModal(false)}\r\n-          className=\"bg-yellow-500 hover:bg-yellow-400 text-black font-black py-3 px-8 rounded-full transition-transform active:scale-95 shadow-lg\"\r\n-        >\r\n-          ·Äú·ÄÄ·Ä∫·ÄÅ·Ä∂·Äô·Ää·Ä∫\r\n-        </button>\r\n-      </div>\r\n-    </div>\r\n-  </div>\r\n-)}\r\n+      )}\r\n       {/* Score UI */}\r\n       <div className=\"absolute top-5 left-5 z-[1000] bg-white p-3 rounded-xl shadow-lg text-black font-bold\">\r\n         Score: {score}\r\n       </div>\r\n \r\n-      <MapContainer \r\n-        center={position} \r\n-        zoom={20} \r\n+      <MapContainer\r\n+        center={position}\r\n+        zoom={20}\r\n         maxBounds={bounds}\r\n         style={{ height: \"100%\", width: \"100%\" }}\r\n       >\r\n-        <ImageOverlay\r\n-          url=\"/images/prev_27.png\"\r\n-          bounds={bounds}\r\n-          zIndex={10}\r\n-        />\r\n+        <ImageOverlay url=\"/images/prev_27.png\" bounds={bounds} zIndex={10} />\r\n \r\n         <ChangeView center={position} />\r\n \r\n         {/* User Marker */}\r\n-       <Marker position={position} icon={charIcon} zIndexOffset={1000} />\r\n+        <Marker position={position} icon={charIcon} zIndexOffset={1000} />\r\n \r\n-{gameBoxes?.map((box) => (\r\n-  <Marker \r\n-    key={box.id} \r\n-    position={[box.lat, box.lng]} \r\n-    icon={boxIcon}\r\n-    zIndexOffset={500} // Image ·Äõ·Ä≤·Ä∑ ·Ä°·Äï·Ä±·Ä´·Ä∫·Äô·Äæ·Ä¨ ·Äï·Ä±·Ä´·Ä∫·Äî·Ä±·Äñ·Ä≠·ÄØ·Ä∑\r\n-    eventHandlers={{\r\n-      click: () => handleCollect(box),\r\n-    }}\r\n-  />\r\n-))}\r\n+        {gameBoxes?.map((box) => (\r\n+          <Marker\r\n+            key={box.id}\r\n+            position={[box.lat, box.lng]}\r\n+            icon={boxIcon}\r\n+            zIndexOffset={500} // Image ·Äõ·Ä≤·Ä∑ ·Ä°·Äï·Ä±·Ä´·Ä∫·Äô·Äæ·Ä¨ ·Äï·Ä±·Ä´·Ä∫·Äî·Ä±·Äñ·Ä≠·ÄØ·Ä∑\r\n+            eventHandlers={{\r\n+              click: () => handleCollect(box),\r\n+            }}\r\n+          />\r\n+        ))}\r\n       </MapContainer>\r\n     </div>\r\n   );\r\n-}\n+}\r\n"
                },
                {
                    "date": 1768817968143,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -97,9 +97,9 @@\n     // User ·Äõ·Ä≤·Ä∑ ·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠·Äî·Ä±·Äõ·Ä¨ ·Äî·Ä≤·Ä∑ Box ·Äõ·Ä≤·Ä∑·Äî·Ä±·Äõ·Ä¨ ·Ä°·ÄÄ·ÄΩ·Ä¨·Ä°·Äù·Ä±·Ä∏·ÄÄ·Ä≠·ÄØ ·Äê·ÄΩ·ÄÄ·Ä∫·Äô·Äö·Ä∫\r\n     const distance = getDistance(position[0], position[1], box.lat, box.lng);\r\n \r\n     // ·ÅÖ ·Äô·ÄÆ·Äê·Ä¨·Äë·ÄÄ·Ä∫ ·Äù·Ä±·Ä∏·Äî·Ä±·Äõ·ÄÑ·Ä∫ ·ÄÄ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äô·Äï·Ä±·Ä∏·Äò·Ä∞·Ä∏\r\n-    if (distance > 5) {\r\n+    if (distance > 20) {\r\n       const roundedDist = Math.round(distance);\r\n       alert(\r\n         `·Äù·Ä±·Ä∏·Äú·ÄΩ·Äî·Ä∫·Ä∏·Äï·Ä´·Äû·Ä±·Ä∏·Äê·Äö·Ä∫! ·Äû·ÄÑ·Ä∫·ÄÄ ${roundedDist} ·Äô·ÄÆ·Äê·Ä¨ ·Ä°·ÄÄ·ÄΩ·Ä¨·Äô·Äæ·Ä¨ ·Äõ·Äæ·Ä≠·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫·Åã ·Ä°·Äî·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äú·Äô·Ä∫·Ä∏·Äú·Äª·Äæ·Ä±·Ä¨·ÄÄ·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äï·Ä´ üö∂‚Äç‚ôÇÔ∏è`,\r\n       );\r\n"
                }
            ],
            "date": 1768814044084,
            "name": "Commit-0",
            "content": "// src/components/FreeMap.tsx\r\n\"use client\";\r\nimport { MapContainer, TileLayer, Marker, useMap } from \"react-leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport L from \"leaflet\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\n// Marker Icon Fix\r\nconst icon = L.icon({\r\n  iconUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png\",\r\n  shadowUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png\",\r\n});\r\n\r\nfunction ChangeView({ center }: { center: [number, number] }) {\r\n  const map = useMap();\r\n  useEffect(() => {\r\n    map.setView(center, map.getZoom());\r\n  }, [center, map]);\r\n  return null;\r\n}\r\n\r\n// ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä±·Ä´·ÄÄ·Ä∫ default export ·Äñ·Äº·ÄÖ·Ä∫·Äõ·Äï·Ä´·Äô·Äö·Ä∫\r\nexport default function FreeMap({ boxes }: { boxes: any[] }) {\r\n  const [position, setPosition] = useState<[number, number]>([16.8400, 96.1730]);\r\n\r\n  useEffect(() => {\r\n    if (typeof window !== \"undefined\") {\r\n      const watchId = navigator.geolocation.watchPosition(\r\n        (pos) => setPosition([pos.coords.latitude, pos.coords.longitude]),\r\n        (err) => console.error(err),\r\n        { enableHighAccuracy: true }\r\n      );\r\n      return () => navigator.geolocation.clearWatch(watchId);\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"h-full w-full\">\r\n      <MapContainer center={position} zoom={19} style={{ height: \"100%\", width: \"100%\" }}>\r\n        <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\r\n        <ChangeView center={position} />\r\n        <Marker position={position} icon={icon} />\r\n        {boxes.map((box) => (\r\n          <Marker key={box.id} position={[box.lat, box.lng]} icon={icon} />\r\n        ))}\r\n      </MapContainer>\r\n    </div>\r\n  );\r\n}"
        }
    ]
}